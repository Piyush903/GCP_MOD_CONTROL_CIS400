{
  "index": "8f8edb77-d503-47bb-b84d-606ac31c6672",
  "description": "In order to prevent unnecessary project ownership assignments to users/service-accounts and further misuses of projects and resources, all roles/Owner assignments should be monitored. Members (users/Service-Accounts) with a role assignment to primitive role roles/Owner are project owners.",
  "modName": "gcp_compliance",
  "resourceName": "cis_v400_2_4",
  "severity": "low",
  "sql": "WITH filter_data AS (\n  SELECT \n    m.project AS project, \n    display_name AS alert_name, \n    COUNT(m.name) AS metric_name \n  FROM \n    gcp.gcp_monitoring_alert_policy as a,\n    jsonb_array_elements(conditions) AS filter_condition \n  JOIN \n    gcp.gcp_logging_metric m \n  ON \n    m.filter LIKE '%protoPayload.serviceName:\"cloudresourcemanager.googleapis.com\"%'\n    AND (\n      m.filter LIKE '%ProjectOwnership%'\n      OR m.filter LIKE '%projectOwnerInvitee%'\n      OR (m.filter LIKE '%protoPayload.serviceData.policyDelta.bindingDeltas.action:\"REMOVE\"%'\n        AND m.filter LIKE '%protoPayload.serviceData.policyDelta.bindingDeltas.role:\"roles/owner\"%')\n      OR (m.filter LIKE '%protoPayload.serviceData.policyDelta.bindingDeltas.action:\"ADD\"%'\n        AND m.filter LIKE '%protoPayload.serviceData.policyDelta.bindingDeltas.role:\"roles/owner\"%')\n    )\n  AND \n    filter_condition -> 'conditionThreshold' ->> 'filter' LIKE '%metric.type = \"' || m.metric_descriptor_type || '\"%'\n  WHERE \n    enabled \n\tand m.project_id=projectId\n\tand m.cd_snapshot_version=snapshotVersion\n\tand a.project_id=projectId\n\tand a.cd_snapshot_version=snapshotVersion\n  GROUP BY \n    m.project, display_name, m.name\n) \nSELECT \n  'https://cloudresourcemanager.googleapis.com/v1/projects/' || project_id AS resource, \n  CASE \n    WHEN d.metric_name > 0 THEN 'ok' \n    ELSE 'alarm' \n  END AS status, \n  CASE \n    WHEN d.metric_name > 0 THEN 'Log metric and alert exist for project ownership assignments/changes.' \n    ELSE 'Log metric and alert do not exist for project ownership assignments/changes.' \n  END AS reason, \n  project_id AS project \nFROM \n  gcp.gcp_project AS p \nLEFT JOIN \n  filter_data AS d ON d.project = project\n  \twhere p.project_id=projectId\n\tand p.cd_snapshot_version=snapshotVersion;",
  "title": "2.4 Ensure Log Metric Filter and Alerts Exist for Project Ownership Assignments/Changes",
  "path": null,
  "qualifiedName": null,
  "query": "gcp_compliance.query.logging_metric_alert_project_ownership_assignment",
  "controlLevel": "master",
  "createdAt": [
    2025,
    11,
    23,
    23,
    55,
    51,
    711574000
  ],
  "remediationAvailable": false,
  "anonymous": false,
  "type": "Project",
  "isMaster": true,
  "__path": "/home/piyushnijhawan/Desktop/steampipe-mod-gcp-compliance/cis_v400/mod_control/cis_v400_2_4"
}