{
  "index": "f991b63d-a3f4-4650-b4cd-bd271cd285a8",
  "description": "IAP authenticates the user requests to your apps via a Google single sign in. You can then manage these users with permissions to control access. It is recommended to use both IAP permissions and firewalls to restrict this access to your apps with sensitive information.",
  "modName": "gcp_compliance",
  "resourceName": "cis_v400_3_10",
  "severity": "medium",
  "sql": "select\n  self_link resource,\n  case\n    when\n      ( allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\",\"443\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\"]}]'\n      )\n      and (source_ranges ?& array['130.211.0.0/22']\n        or source_ranges ?& array['35.235.240.0/20']\n        or source_ranges ?& array['35.191.0.0/16']\n        or source_ranges ?& array['35.191.0.0/16', '130.211.0.0/22']\n        or source_ranges ?& array['35.191.0.0/16', '35.235.240.0/20']\n        or source_ranges ?& array['130.211.0.0/22', '35.235.240.0/20']\n        or source_ranges ?& array['130.211.0.0/22', '35.235.240.0/20', '35.191.0.0/16'])\n      then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when\n      ( allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\",\"443\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\",\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\",\"3389\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"443\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"22\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"80\"]}]'\n        or allowed @> '[{\"IPProtocol\":\"tcp\",\"ports\":[\"3389\"]}]'\n      )\n      and (source_ranges ?& array['130.211.0.0/22']\n        or source_ranges ?& array['35.235.240.0/20']\n        or source_ranges ?& array['35.191.0.0/16']\n        or source_ranges ?& array['35.191.0.0/16', '130.211.0.0/22']\n        or source_ranges ?& array['35.191.0.0/16', '35.235.240.0/20']\n        or source_ranges ?& array['130.211.0.0/22', '35.235.240.0/20']\n        or source_ranges ?& array['130.211.0.0/22', '35.235.240.0/20', '35.191.0.0/16'])\n      then title || ' IAP configured to allow traffic from Google IP addresses.'\n    else title || ' IAP not configured to allow traffic from Google IP addresses.'\n  end as reason\n  , location as location, project as project\nfrom\n  gcp.gcp_compute_firewall\nwhere project_id=projectId\nand cd_snapshot_version=snapshotVersion;",
  "title": "3.10 Use Identity Aware Proxy (IAP) to Ensure Only Traffic From Google IP Addresses are 'Allowed'",
  "path": null,
  "qualifiedName": null,
  "query": "gcp_compliance.query.manual_control",
  "controlLevel": "master",
  "createdAt": [
    2025,
    11,
    23,
    10,
    15,
    29,
    726859000
  ],
  "remediationAvailable": false,
  "anonymous": false,
  "type": "Project",
  "isMaster": true,
  "__path": "/home/piyushnijhawan/Desktop/steampipe-mod-gcp-compliance/cis_v400/mod_control/cis_v400_3_10"
}