{
  "index": "8d45418b-812f-49a8-8a6b-82a2a3266865",
  "description": "GCP `Firewall Rules` are specific to a `VPC Network`. Each rule either allows or denies traffic when its conditions are met. Its conditions allow users to specify the type of traffic, such as ports and protocols, and the source or destination of the traffic, including IP addresses, subnets, and instances.",
  "modName": "gcp_compliance",
  "resourceName": "cis_v400_3_7",
  "severity": "high",
  "sql": "WITH ip_protocol_all AS (\n    SELECT\n        name\n    FROM\n        gcp.gcp_compute_firewall\n    WHERE\n        direction = 'INGRESS'\n        AND project_id=projectId\n        AND cd_snapshot_version=snapshotVersion\n        AND action = 'Allow'\n        AND source_ranges ?& array['0.0.0.0/0']\n        AND (allowed @> '[{\"IPProtocol\":\"all\"}]' OR allowed::text LIKE '%{\"IPProtocol\":\"tcp\"}%' OR allowed::text LIKE '%{\"IPProtocol\":\"udp\"}%')\n),\nip_protocol_rdp AS (\n    SELECT\n        name\n    FROM\n        gcp.gcp_compute_firewall,\n        jsonb_array_elements(allowed) AS p,\n        jsonb_array_elements_text(p -> 'ports') AS port\n    WHERE\n        direction = 'INGRESS'\n        AND project_id=projectId\n        AND cd_snapshot_version=snapshotVersion\n        AND action = 'Allow'\n        AND source_ranges ?& array['0.0.0.0/0']\n        AND p ->> 'IPProtocol' = 'tcp'\n        AND (\n            port = '3389'\n            OR (\n                port LIKE '%-%'\n                AND split_part(port, '-', 1)::integer <= 3389\n                AND split_part(port, '-', 2)::integer >= 3389\n            )\n        )\n)\nSELECT\n    self_link AS resource,\n    CASE\n        WHEN name IN (SELECT name FROM ip_protocol_rdp) THEN 'alarm'\n        WHEN name IN (SELECT name FROM ip_protocol_all) THEN 'alarm'\n        ELSE 'ok'\n    END AS status,\n    CASE\n        WHEN name IN (SELECT name FROM ip_protocol_rdp)\n            THEN 'Firewall rule allows connections from all IP addresses on TCP or UDP port 3389.'\n        WHEN name IN (SELECT name FROM ip_protocol_all)\n            THEN 'Firewall rule allows connections from all IP addresses on TCP or UDP port 3389 within the range 0-65535.'\n        ELSE 'Firewall rule does not allow connections from all IP addresses on TCP or UDP port 3389.'\n    END AS reason,\n    location AS location,\n    project AS project\nFROM\n    gcp.gcp_compute_firewall\nWHERE\n    project_id=projectId\n    AND cd_snapshot_version=snapshotVersion;",
  "title": "3.7 Ensure That RDP Access Is Restricted From the Internet",
  "path": null,
  "qualifiedName": null,
  "query": "gcp_compliance.query.compute_firewall_rule_rdp_access_restricted",
  "controlLevel": "master",
  "createdAt": [
    2025,
    11,
    23,
    23,
    55,
    51,
    709521000
  ],
  "remediationAvailable": false,
  "anonymous": false,
  "type": "Project"
}