{
  "index": "93fbc10a-9926-4818-80f3-62e687d53669",
  "description": "Enabling retention policies on log buckets will protect logs stored in cloud storage buckets from being overwritten or accidentally deleted. It is recommended to set up retention policies and configure Bucket Lock on all storage buckets that are used as log sinks.",
  "modName": "gcp_compliance",
  "resourceName": "cis_v400_2_3",
  "severity": "medium",
  "sql": "with logging_sinks as (\n  select\n    self_link,\n    title,\n    project,\n    location,\n    destination\n  from\n    gcp.gcp_logging_sink\n        where project_id=projectId\n        and cd_snapshot_version=snapshotVersion\n)\nselect\n  s.self_link resource,\n  case\n    when b.retention_policy is not null and b.retention_policy ->> 'isLocked' = 'true' then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when b.retention_policy is not null and b.retention_policy ->> 'isLocked' = 'true'\n      then s.title || '''s logging bucket ' || b.name || ' has retention policies configured.'\n    else s.title || '''s logging bucket ' || b.name || ' has retention policies not configured.'\n  end as reason\n  , s.location as location, s.project as project\nfrom\n  gcp.gcp_storage_bucket b\n  join logging_sinks s on (\n  split_part(s.destination, '/', 1) = 'storage.googleapis.com'\n  and split_part(s.destination, '/', 2) = b.name\n)\nwhere project_id=projectId\nand cd_snapshot_version=snapshotVersion;",
  "title": "2.3 Ensure That Retention Policies on Cloud Storage Buckets Used for Exporting Logs Are Configured Using Bucket Lock",
  "path": null,
  "qualifiedName": null,
  "query": "gcp_compliance.query.manual_control",
  "controlLevel": "master",
  "createdAt": [
    2025,
    11,
    23,
    10,
    15,
    29,
    728288000
  ],
  "remediationAvailable": false,
  "anonymous": false,
  "type": "Project",
  "isMaster": true,
  "__path": "/home/piyushnijhawan/Desktop/steampipe-mod-gcp-compliance/cis_v400/mod_control/cis_v400_2_3"
}